<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>elm-live testing</title>
</head>

<body>
    <header>
        <h1>elm-live Testing</h1>
    </header>
    <script>
        var sanitizeHTML = function (str, type) {
            if (type === 'console') {
                return str;
            } else {
                var temp = document.createElement('div')
                temp.textContent = str
                return temp.innerHTML
            }
        }

        var colorConverter = function (color, type) {
            if (color === 'green') {
                if (type === 'console') {
                    return 'green'
                } else {
                    return 'lightgreen'
                }
            } else if (color === 'cyan') {
                if (type === 'console') {
                    return 'blue'
                } else {
                    return 'cyan'
                }
            } else if (color === 'yellow') {
                return 'orange'
            } else {
                return color
            }
        }

        function restoreColor(parsedError, type) {
            var styles = []
            var styleNormal = 'color:#333'
            var coloredError =
                parsedError.errors.map(function (err) {
                    return err.problems.map(function (pro) {
                        var headerContent = pro.title.replace('-', ' ') + ' --------------- ' + err.path // + " at " + pro.region.start.line + ":" + pro.region.start.column
                        var color = 'color:' + colorConverter('cyan', type)
                        var header = ''
                        if (type === 'console') {
                            styles.push(color, styleNormal)
                            header = '%c-- ' + headerContent + '%c\n\n'
                        } else {
                            header = "<span style='" + color + "'>-- " + headerContent + '</span>\n\n'
                        }
                        return [header].concat(pro.message.map(function (mes) {
                            if (typeof mes === 'string') {
                                return sanitizeHTML(mes, type)
                            } else {
                                var color;
                                if (mes.underline) {
                                    color = 'color:' + colorConverter('green', type)
                                } else if (mes.color) {
                                    color = 'color:' + colorConverter(mes.color, type)
                                }
                                if (type === 'console') {
                                    styles.push(color, styleNormal)
                                    return '%c' + sanitizeHTML(mes.string, type) + '%c'
                                } else {
                                    return "<span style='" + color + "'>" + sanitizeHTML(mes.string, type) + '</span>'
                                }
                            }
                        })).join('')
                    }).join('\n\n\n')
                }).join("\n\n\n\n\n")

            if (type === 'console') {
                return [coloredError].concat(styles)
            } else {
                return coloredError
            }
        }

        function showError(error) {
            var parsedError = JSON.parse(error)
            var coloredError = restoreColor(parsedError)
            console.log.apply(this, restoreColor(parsedError, 'console'))
            if (hideCompiling()) {
                setTimeout(function () {
                    showError_(coloredError)
                }, 400)
            } else {
                showError_(coloredError)
            }
        }

        function showError_(error) {
            var nodeContainer = document.getElementById('elm-live:elmErrorContainer')
            if (!nodeContainer) {
                nodeContainer = document.createElement('div')
                nodeContainer.id = 'elm-live:elmErrorContainer'
                document.body.appendChild(nodeContainer)
            }
            nodeContainer.innerHTML =
                "<div id='elm-live:elmErrorBackground' style='z-index: 100; perspective: 500px; transition: opacity 0.3s; opacity: 0; position: fixed; top: 0; left: 0; background-color: rgba(0,0,0,0.3); width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;'>" +
                "<pre id='elm-live:elmError' style='transform: rotateX(-90deg); transition: transform 0.3s; transform-style: preserve-3d; font-size: 16px; overflow: scroll; background-color: rgba(0,0,0,0.9); color: #ddd; width: 70%; height: 60%; padding: 30px'>" +
                error +
                '</pre>' +
                '</div>'
            setTimeout(function () {
                document.getElementById('elm-live:elmErrorBackground').style.opacity = 1
                document.getElementById('elm-live:elmError').style.transform = 'rotateX(0deg)'
            }, 0)
        }

        function hideError() {
            var node = document.getElementById('elm-live:elmErrorContainer')
            if (node) {
                document.getElementById('elm-live:elmErrorBackground').style.opacity = 0
                document.getElementById('elm-live:elmError').style.transform = 'rotateX(-90deg)'
                setTimeout(function () {
                    document.getElementById('elm-live:elmErrorContainer').remove()
                }, 300)
            }
        }

        function showCompiling(message) {
            hideError()
            var nodeContainer = document.getElementById('elm-live:elmCompilingContainer')
            if (!nodeContainer) {
                nodeContainer = document.createElement('div')
                nodeContainer.id = 'elm-live:elmCompilingContainer'
                document.body.appendChild(nodeContainer)
            }
            nodeContainer.innerHTML =
                '<style>' +
                '#loading {' +
                '  display: inline-block;' +
                '  width: 50px;' +
                '  height: 50px;' +
                '  border: 3px solid rgba(255,255,255,.3);' +
                '  border-radius: 50%;' +
                '  border-top-color: #fff;' +
                '  animation: spin 1s linear infinite;' +
                '}' +
                '@keyframes spin {' +
                'to { transform: rotate(360deg); }' +
                '}' +
                '</style>' +
                "<div id='elm-live:elmCompilingBackground' style='z-index: 100; transition: opacity 0.3s; opacity: 0; position: fixed; top: 0; left: 0; background-color: rgba(0,0,0,0.3); width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; flex-direction: column'>" +
                "<div id='loading'>" +
                '</div>' +
                "<div style='color: #fff; padding: 30px; font-size: 24px; font-weight: bold; font-family: sans-serif'>" +
                message +
                '</div>' +
                '</div>'
            setTimeout(function () {
                document.getElementById('elm-live:elmCompilingBackground').style.opacity = 1
            }, 0)
        }

        function hideCompiling() {
            var node = document.getElementById('elm-live:elmCompilingContainer')
            if (node) {
                document.getElementById('elm-live:elmCompilingBackground').style.opacity = 0
                setTimeout(function () {
                    document.getElementById('elm-live:elmCompilingContainer').remove()
                }, 300)
                return (true)
            } else {
                return (false)
            }
        }
    </script>


    <script>
        showCompiling("Blah blah blah");
        setTimeout(function () {
            showError(
                '{"type":"compile-errors","errors":[{"path":"src/Main.elm","name":"Main","problems":[{"title":"NAMING ERROR","region":{"start":{"line":35,"column":11},"end":{"line":35,"column":18}},"message":["I cannot find a `button2` variable:\\n\\n35|         [ button2 [ onClick Increment ] [ text \\"Increment +1\\" ]\\n              ",{"bold":false,"underline":false,"color":"red","string":"^^^^^^^"},"\\nThese names seem close though:\\n\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"button"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"atan2"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"Sub.none"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"atan"},"\\n\\n",{"bold":false,"underline":true,"color":null,"string":"Hint"},": Read <https://elm-lang.org/0.19.0/imports> to see how `import`\\ndeclarations work in Elm."]},{"title":"NAMING ERROR","region":{"start":{"line":36,"column":20},"end":{"line":36,"column":25}},"message":["I cannot find a `textt` variable:\\n\\n36|         , div [] [ textt <| String.fromInt model.count ]\\n                       ",{"bold":false,"underline":false,"color":"red","string":"^^^^^"},"\\nThese names seem close though:\\n\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"text"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"e"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"max"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"negate"},"\\n\\n",{"bold":false,"underline":true,"color":null,"string":"Hint"},": Read <https://elm-lang.org/0.19.0/imports> to see how `import`\\ndeclarations work in Elm."]},{"title":"NAMING ERROR","region":{"start":{"line":37,"column":11},"end":{"line":37,"column":18}},"message":["I cannot find a `button3` variable:\\n\\n37|         , button3 [ onClick Decrement ] [ text \\"-1\\" ]\\n              ",{"bold":false,"underline":false,"color":"red","string":"^^^^^^^"},"\\nThese names seem close though:\\n\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"button"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"Sub.none"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"atan"},"\\n    ",{"bold":false,"underline":false,"color":"yellow","string":"atan2"},"\\n\\n",{"bold":false,"underline":true,"color":null,"string":"Hint"},": Read <https://elm-lang.org/0.19.0/imports> to see how `import`\\ndeclarations work in Elm."]}]}]}'
            );
        }, 1000)
        // setTimeout(function () {
        //     showCompiling();
        // }, 2000)
        // setTimeout(function () {
        //     hideCompiling();
        // }, 3000)
        // setTimeout(function () {
        //     showError(
        //         "-- NAMING ERROR --------------------------------------------------- src/Main.elm\n\nI cannot find a `xxx` variable:\n\n371|         Html.text \"\" xxx\n                          ^^^\nThese names seem close though:\n\n    max\n    px\n    xor\n    SA.x\n\nHint: Read <https://elm-lang.org/0.19.0/imports> to see how `import`\ndeclarations work in Elm."
        //     );
        // }, 4000)
        // setTimeout(function () {
        //     hideError();
        // }, 5000)
    </script>
</body>

</html>